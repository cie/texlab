#!/usr/bin/env ruby
# encoding: ASCII-8bit




require 'erb'
require 'to_latex'

$: << File.expand_path(__FILE__+"/../../lib")

class TEXERB < ERB
end

begin
  # load code
  #
  infile = ARGV[0] || fail
  outfile = ARGV[1] || infile.sub(/(\.texlab)?$/, ".tex")

  src = nil
  File.open infile do |f|
    src = f.read
  end
  fail if !src

rescue
        STDERR.puts File.basename($0) + " <inputfile> <outputfile>"
        STDERR.puts <<EOU
  Compile texlab inputfile to tex. 
EOU

else

  # load boot code
  File.open File.expand_path(__FILE__+"/../../lib/texlab/boot.rb") do |f|
    src = "<%\n" << f.read << "\n%>\n" << src
  end

  # run erb
  erb = TEXERB.new(src.untaint, nil, "%>", "$_erbout")

  File.open outfile, "w" do |f|
    f.print erb.result(TOPLEVEL_BINDING.taint)
  end

end

